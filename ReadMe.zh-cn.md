## 源代码行数统计工具
一个基于C++实现的源代码行数统计工具，对指定路径的源代码进行分析统计，输出不同语言的文件数，物理行数，代码行数，注释行数，以及空白行数。

##### Version: 1.0.0-SNAPSHOT

### Usage
最简单的方式：
在终端中输入：`SourceCounter [path]` 即可对 `path` 路径中所有支持的语言的源代码进行统计并输出结果，`path`  参数可以是一个目录，也可以是单个文件路径。示例如下：
```shell
$> ./SourceCounter demo.c
+------------+------------+------------+------------+------------+
|      Files |      Lines |      Codes |   Comments |     Blanks |
+------------+------------+------------+------------+------------+
|          1 |         27 |         10 |         10 |          7 |
+------------+------------+------------+------------+------------+
```
统计工具支持多个命令行选项，以决定统计的行为和输出的方式，因此，也可以通过指定多个命令行选项来运行该工具，例如：
```shell
$> ./SourceCounter --input demo.c --mode=63
+------------+------------+------------+------------+------------+
|      Files |      Lines |      Codes |   Comments |     Blanks |
+------------+------------+------------+------------+------------+
|          1 |         27 |         10 |         18 |          8 |
+------------+------------+------------+------------+------------+
```

#### 支持的命令行参数
```text
     --help, -h  获取帮助信息。
  --version, -v  输出版本信息。
    --input, -i  [必需] 指定要统计的源代码所在的路径，可以是一个目录路径，也可以是单个文件路径。
   --output, -o  [可选] 指定统计结果输出的位置，若指定，则以json格式输出每个源代码文件的统计详情，否则不输出。
   --config, -c  [可选] 指定不同语言语法规则的配置文件路径。
     --mode, -m  [可选] 指定针对具有歧义的行进行解释的方式。
--languages, -l  [可选] 指定要统计的语言，若不指定则统计所有内置支持的语言。
  --exclude, -e  [可选] 指定要排除的文件，按正则表达式匹配。
   --detail, -d  [可选] 指定终端中输出按语言分类的统计详情以及排序规则。
   --thread, -t  [可选] 指定建议程序使用的线程数，但并不一定采纳。
  --explain, -x  [可选] 在其他所有命令行参数都正确的情况下，对参数值进行解释输出。
        --empty  [可选] 指定是否允许空文件。
```

#### 命令选项释义
* **--ouput, -o**：默认统计工具仅在屏幕输出汇总后的统计结果，要想获得每个文件的统计结果或者意图将结果输出到文件以供其他地方使用，那么需要利用该选项指定输出的文件位置，否则将不输出。
* **--config, -c**：统计工具在分析源代码行数的时候会需要用到对应语言的语法规则，例如对注释和字符串如何判定？因此需要提供一个配置文件来描述这些语言的部分语法特征，使用该选项指定配置文件路径。配置文件采用 `json` 格式，示例配置如下：
  ```json
  {
      "C++": {
          "extensions": [".cpp", ".cc", ".inl"],
          "options": [ ["//"],
                       [["/*", "*/"]],
                       [["\"", "\""]],
                       [["R\"(", ")\""]] 
                     ]
      },
      "Java": {
          "extensions": [".java"],
          "options": [ ["//"],
                       [["/*", "*/"]],
                       [["\"", "\""]],
                       [] 
                     ]
      }
  }
  ```
  * 其中 `options` 字段可能需要配置4组语法特征，分别对应：单行注释符号，多行注释符号，普通字符串符号，原生字符串符号，如果某些特征没有，则可以不配置。
  * 统计工具默认会内置一些语言的语法规则(要查看内置支持的语言列表可以键入：`SourceCounter -x -i .`)。内置支持的语言配置规则不允许修改，即使配置文件中配置了也会忽略，但可以配置其对应的文件扩展名。
* **--mode, -m**：即使指定了不同语言的语法规则，也不一定就能准确的对行数进行判定，这是因为，即便是相同代码，不同的人会有不同的理解，例如下面的 C++ 代码示例：
  ```C++
  int main(/* void */)
  {
      /* to do
      
       */
       return 0;
  }
  ```
  这段代码的物理行数一共只有7行，这毋庸置疑。但对于其他类型的行的释义则显得有些模糊，因为没有一个统一的标准。例如第一行中，有效代码和注释同时存在，有的人认为这既是代码行也是注释行，但有的人认为一行数据不能统计成两行，因此仅算作代码行。而注释 `/* to do` 下面的空白行则更容易引起争论，到底算注释还是空行？而我们也不能确定，或者说不能替使用者决定。因此，此时就可以使用 `--mode` 选项，由使用者来自己来决定具有歧义的行应该如何解释，具有歧义的行有下面3种情况：
  * Case1: 多行注释中包含的空白行。
  * Case2: 多行字符串中包含的空白行。
  * Case3: 一行中同时包含有效代码和注释。
  
  我们采用不同的值来表达不同情况下的具体释义，下面是每种值的解释：
  
   | name | value | explain |
   | --- | --- | --- |
   | mc_is_blank   | 1  | Case1 is Blank Line |
   | mc_is_comment | 2  | Case1 is Comment Line |
   | ms_is_code    | 4  | Case2 is Code Line |
   | ms_is_blank   | 8  | Case2 is Blank Line |
   | cc_is_code    | 16 | Case3 is Code Line |
   | cc_is_comment | 32 | Case3 is Comment Line |
   
   需要注意的是，不同的值可以通过 **位或** (或加法)运算组合使用，例如：`--mode=48` 而 48 = 16 + 32 这意味着指定48，那么当 **一行中同时包含有效代码和注释** 的时候，该行 **既统计为代码行，又统计为注释行。**
* **--languages, -l, --exclude, -e**：统计工具内置的语言以及配置文件中配置的语言都将得到支持，这通常会导致大量的语言都得到支持，我正是我们想要的，但使用者在统计的时候可能并不想分析所有的源代码，而仅想获得自己关注的某些语言的分析统计结果，此时就可以使用 `--languages` 选项指定，例如：`--languages=C,Java,Python` 意味着统计工具仅分析 C, Java, Python 这3种语言源代码文件的统计结果，前提是统计工具也支持这3种语言。而 `--exclude` 选项则用来排除文件，利用正则表达式对每个文件的绝对路径进行匹配，所有匹配到的文件将不会被统计。
* **--thread, -t** 此选项建议统计工具运行时使用的线程数量，为什么是建议？因为如果指定一个较大的数字，统计程序当然不会同时分配如此多的线程。一般指定一个小于32的数字，且不大于目标文件的数量，建议生效。
* **--explain, -x** 一旦指定该选项，统计工具将不会真正执行统计工作，仅对当前使用的参数信息进行解释输出，前提是所有的选项和参数都指定正确。例如想在真正运行前查看输入的选项或参数是否和预期的一致，可以添加该选项查看。

### Design
解析器设计用于对一组命令行参数按照指定的规则进行解析，规则包括：
* 命令行参数的格式，以下格式都是合法的：
```
-a
-ab
--abc value
--abc=value
```
* 参数值的类型(参见枚举`value_t`)
```C++
vt_string   // 字符串
vt_integer  // 有符号整数
vt_unsigned // 无符号整数
vt_float    // 浮点数
vt_boolean  // 布尔类型
vt_nothing  // 参数没有值
```
* 参数和值出现的规则，包括：
  * 参数是否具有唯一性，意味着命令行中一旦指定了该参数，将不能再指定其他任何参数。
  * 参数是否必须，即必须指定的参数，但如果已经指定了具有唯一性的参数，可以不指定。
  * 参数必须有值，即指定参数的同时必须为其指定一个值，否则可以不指定。

#### 举例说明
* 假设规定命令行参数中可能包含：
  * 参数名：`--input`，值类型：`string`，此参数必须在命令行中指定，同时也必须指定值。
  * 参数名：`--config`，值类型：`integer`，此参数必须在命令行中指定，但是值可选。
  * 参数名：`--status`，值类型：`bool`，可以不用在命令行中指定该参数，如果指定，其值也是可选的。
* 那么不同的情形解析结果如下：
  ```
  01 "--input /etc/dir/ --config 7 --status true" // ok: 参数名正确，对应的值类型也正确
  02 "--input /etc/dir/ --config=7 --status=true" // ok: 支持[key=value]的格式
  03 "--config 7 --input /etc/dir/ --status=true" // ok: 参数顺序可任意排列
  04 "--input /etc/dir/ --config 7"               // ok: --status 可以不指定
  05 "--input /etc/dir/ --config 7 --status"      // ok: --status 的值可以不指定
  06 "--input /etc/dir/ --config 7 --status="     // error: 在具有[key=value]格式的时候必须指定值
  07 "--input /etc/dir/ --status true"            // error: --config 必须要指定
  08 "--input /etc/dir/ --config 7 --status 1"    // error: --status 参数值类型错误
  09 "--output --config 7 --status true"          // error: 不能识别的参数 --output
  10 "--config 7 --status=true --input"           // error: 必须为参数 --input 指定一个值
  11 "--input --config 7 --status=true"           // error: 不能识别的参数 7
  12 "--input=/etc/dir/ --config --output"        // error: 参数 --config 值类型错误
  ```
  * 在情形11中，由于参数`--input`指定必须有值，因此紧跟其后的`--config`被视作为`--input`对应的值，则`7`被判定为不能识别的参数名。
  * 在情形12中，由于参数`--config`的值是可选的，因此优先判定后面的`--output`是否是有效的参数名，如果是，则判定`--config`没有指定值，如果不是，则将`--output`作为`--config`的值，但类型错误。





    const std::map<unsigned int, std::string> _sc_help_map{
    {_sc_cmd::_sc_cmd_help,
    R"(  --help, -h: 获取帮助信息
    用法：--help [command]
    示例：--help
          --help --input
          --help --config
)"},

{_sc_cmd::_sc_cmd_version,
R"(  --version, -v: 查看版本信息
    用法：--version
    示例：--version
)"},

{_sc_cmd::_sc_cmd_input,
R"(  --input, -i: (必需)指定要进行统计的输入路径，可以是一个文件或者目录。
    用法：--input [path]
    示例：--input /Users/Name/main.cpp
          --input /Users/Name/Sources/
)"},

{_sc_cmd::_sc_cmd_output,
R"(  --output, -o: (可选)指定统计信息输出的文件，输出信息为json格式。
                 包含每个文件的统计结果和汇总的统计结果，若不指定则不输出。
    用法：--output [command]
    示例：--output /Users/Name/sc.json
)"},

{_sc_cmd::_sc_cmd_config,
R"(  --config, -c: (可选)指定不同语言语法规则的配置文件路径
                 若不指定，统计程序仅采用内置规则。
                 文件配置以json格式，示例：
                [
                   {"name": "Python",
                    }
                ]
    用法：--config [path]
    示例：--config /Users/Name/languages.json
)"},

{_sc_cmd::_sc_cmd_mode,
R"(  --mode, -m: (可选)指定统计规则，仅针对具有歧义的行进行解释。
               具有歧义的行是指一行中包含多种属性的情况，例如：
               一行中同时有代码和注释，或者多行注释中的空行，以及多行字符串中的空行。
               针对具有歧义的行指定统计规则以得到明确的统计结果，规则值如下：

               name           value  exlpain
               mc_is_blank    1      对于多行注释中的空行，此行算作空白行。
               mc_is_comment  2      对于多行注释中的空行，此行算作注释行。
               ms_is_code     4      对于跨行字符串中的空行，此行算作代码行。
               ms_is_blank    8      对于跨行字符串中的空行，此行算作空白行。
               cc_is_code     16     对于同时包含代码和注释的行，此行算作代码行。
               cc_is_comment  32     对于同时包含代码和注释的行，此行算作注释行。

               不同规则可以组合使用，按其值的位或运算(或加法运算)得到的结果作为"--mode"参数的值。
               例如：若要将多行注释中的空行算作空白行，跨行字符串中的空行算作代码行，
                     同时包含注释和代码的行，既算作代码行也算作注释行。
               可以给"--mode"参数指定值:(1|4|16|32) = 53。即："--mode=53"
    用法：--mode [number]
    示例：--mode 7
)"},

{_sc_cmd::_sc_cmd_languages,
R"(  --languages, -l: (可选)指定统计的语言
                    可指定的语言包括内置语言和配置文件中配置的语言。
                    多个语言之间使用逗号分隔，语言名称不区分大小写。
    用法：--languages [name list]
    示例：--languages C++,Java,Python
)"},

{_sc_cmd::_sc_cmd_exclude,
R"(  --exclude, -e: (可选)一个正则表达式字符串，指定要排除的路径。
                  对于匹配该正则表达式的文件路径，将不会进行统计。
    用法：--exclude [regular expression]
    示例：--exclude *.h
)"},

{_sc_cmd::_sc_cmd_detail,
R"(  --detail, -d: (可选)按语言分类在终端中展示统计结果，可以同时指定排序规则。
                 排序列可以指定：files, lines, codes, comments, blanks
                 排序方式可以指定：(升序)asc[ending], (降序)des[cending]
    用法：--detail [command]
    示例：--detail
          --detail codes|asc
)"},

{_sc_cmd::_sc_cmd_empty,
R"(  --empty: (可选)指定是否统计空文件，默认为：true。
    用法：--empty [bool]
    示例：--empty true
)"},

{_sc_cmd::_sc_cmd_thread,
R"(  --thread, -t: (可选)建议使用的线程数量
                 统计程序本身会根据识别到的文件数量自动调整线程数。
                 如果指定的线程数太大将忽略指定的值。
    用法：--thread [number]
    示例：--thread 4
)"},

{_sc_cmd::_sc_cmd_explain,
R"(  --explain, -x: (可选)若指定该选项，则不进行实际的行数统计，仅对当前程序准备统计使用的参数进行解释。
    用法：--explain
    示例：--explain
)"}
    };